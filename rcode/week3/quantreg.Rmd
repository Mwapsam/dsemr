---
title: "Quantile Regression"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("../theme/theme-mooc.R")
```

```{r, flcolours=TRUE}
library(ismev)
library(quantreg)
data(wavesurge)
par(mar=c(5.1,4.1,2.1,2.1))
plot(wavesurge, xlab="Wave height [m]", ylab="Surge [m]")
taus <-  c(0.1,0.25,0.5,0.75,0.9)
cols <- c(4,3,2,3,4)
for (i in seq_along(taus)) {
    qrm <- rq(wavesurge$surge~wavesurge$wave,tau=taus[i])
    abline(qrm, col=cols[i], lwd=2)
    corners = par("usr") #Gets the four corners of plot area (x1, x2, y1, y2)
    par(xpd = TRUE) #Draw outside plot area
    beta <- coef(qrm)
    text(x = corners[2]+.1, y = beta[1]+beta[2]*corners[2] , paste0(100*taus[i],"%"), srt = 0, adj=c(0,0.5), col=cols[i])
    par(xpd=FALSE)
}
```

```{r, flcolours=TRUE}
library(ismev)
library(quantreg)
data(wavesurge)
par(mar=c(5.1,4.1,2.1,2.1))
plot(wavesurge, xlab="Wave height [m]", ylab="Surge [m]", type="n")
rect(6.25,par()$usr[3],7.25, par()$usr[4], col=grey(0.9), border=NA)
text(6.75,par()$usr[3], "90%", cex=1.5, col=grey(0.8), adj=c(0.5,-0.1))
text(6.75,par()$usr[4], "10%", cex=1.5, col=grey(0.8), adj=c(0.5,1.1))
points(wavesurge)
taus <-  c(0.1,0.25,0.5,0.75,0.9)
cols <- c(4,3,2,3,4)
for (i in seq_along(taus)) {
    qrm <- rq(wavesurge$surge~wavesurge$wave,tau=taus[i])
    abline(qrm, col=cols[i], lwd=2)
    beta <- coef(qrm)
    if (taus[i]==0.9)
      segments(6.25,beta[1]+beta[2]*6.25,7.25,beta[1]+beta[2]*7.25,col=cols[i], lwd=4 )
    corners = par("usr") #Gets the four corners of plot area (x1, x2, y1, y2)
    par(xpd = TRUE) #Draw outside plot area
    beta <- coef(qrm)
    text(x = corners[2]+.1, y = beta[1]+beta[2]*corners[2] , paste0(100*taus[i],"%"), srt = 0, adj=c(0,0.5), col=cols[i])
    par(xpd=FALSE)
}
```
```{r}


```
